import{_ as a}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as i,a as s,f as t,b as n,o}from"./app-CZifbq50.js";const p={};function d(c,e){return o(),i("div",null,[e[0]||(e[0]=s("p",null,"Чтобы пробросить HDD(SSD) в LXC контейнер, на самом деле папку на хосте, нужно выполнить команду:",-1)),t(" more "),e[1]||(e[1]=n(`<div class="language-" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>pct set 102 -mp1 /mnt/mydisk,mp=/mnt/data</span></span></code></pre></div><p><code>pct</code> - Proxmox Container Toolkit, утилита для управления контейнерами.</p><p><code>set</code> - команда выбора контейнера.</p><p><code>102</code> - номер контейнера.</p><p><code>-mp1</code> - опция указывающая номер точки монтирования. Первая начинается с 0, потом 1, потом 2 и так далее, если хотите несколько дисков пробросить в контейнер.</p><p><code>/mnt/mydisk</code> - путь, куда у вас примонтирован диск (ну либо вы просто папку с хоста хотите пробросить в контейнер).</p><p><code>mp=/mnt/data</code> - путь внутри контейнера, куда будет отображаться диск. Эту директорию надо предварительно создать, если её нет.</p><h2 id="изменение-сопоставления-lxc-uid-gid-по-умолчанию" tabindex="-1"><a class="header-anchor" href="#изменение-сопоставления-lxc-uid-gid-по-умолчанию"><span>Изменение сопоставления LXC UID/GID по умолчанию</span></a></h2><div class="hint-container warning"><p class="hint-container-title">Примечание</p><p>Если гостевая система будет скомпрометирована, пользователь/группа с идентификаторами, сопоставленными с гостевой системой на хосте, также будут скомпрометированы. Это может быть проблематично, если скомпрометированный пользователь/группа используется не только для доступа к точке монтирования на хосте.</p></div><h3 id="конфигурация-на-хосте" tabindex="-1"><a class="header-anchor" href="#конфигурация-на-хосте"><span>Конфигурация на хосте</span></a></h3><p>Создадим пользователя который будет владельцем нашей папки:</p><div class="language-" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>useradd -M -s /sbin/nologin -u 1000 username</span></span></code></pre></div><p>Ключ <code>-M</code> заводит пользователя без создания домашнего каталога, а <code>-s /sbin/nologin</code> исключает возможность входа такого пользователя в систему, <code>-u</code> устанавливает UID.</p><p>Меняем владельца нашей папки:</p><div class="language-" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>chown username:username /mnt/mydisk -R</span></span></code></pre></div><p>Устанавливаем права:</p><div class="language-" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>chmod u=rwx,g=rwx,o=rx,g+s /mnt/mydisk</span></span></code></pre></div><p><code>u=rwx</code> — владелец получает права на чтение, запись и выполнение.</p><p><code>g=rwx</code> — группа получает права на чтение, запись и выполнение.</p><p><code>o=rx</code> — остальные получают права на чтение и выполнение.</p><p><code>g+s</code> — установка setgid бита.</p><div class="hint-container info"><p class="hint-container-title">Что делает setgid?</p><p>Для папок: Если setgid бит установлен на папку, все файлы и подкаталоги, созданные внутри этой папки, будут наследовать группу владельца папки, а не группу пользователя, который создал файл. Это полезно для совместного доступа к файлам в группе, прежде всего нужно для корректной работы Samba.</p></div><p>Далее мы добавляем <code>root:1000:1</code> к <code>/etc/subuid</code> и <code>/etc/subgid</code>. Это позволит демону LXC использовать наш желаемый uid/gid на хосте:</p><div class="language-" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>echo &quot;root:1000:1&quot; &gt;&gt; /etc/subuid</span></span>
<span class="line"><span>echo &quot;root:1000:1&quot; &gt;&gt; /etc/subgid</span></span></code></pre></div><p>Наконец, нам нужно изменить конфигурацию контейнера, добавив пользовательское сопоставление.</p><p>По умолчанию конфигурация для контейнера с идентификатором 102 будет находиться по адресу <code>/etc/pve/lxc/102.conf</code>, открываем:</p><div class="language-" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>nano /etc/pve/lxc/102.conf</span></span></code></pre></div><p>Добавляем пользовательскую информацию о сопоставлении LXC:</p><div class="language-" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>lxc.idmap: u 0 100000 1000</span></span>
<span class="line"><span>lxc.idmap: g 0 100000 1000</span></span>
<span class="line"><span>lxc.idmap: u 1000 1000 1</span></span>
<span class="line"><span>lxc.idmap: g 1000 1000 1</span></span>
<span class="line"><span>lxc.idmap: u 1001 101001 64535</span></span>
<span class="line"><span>lxc.idmap: g 1001 101001 64535</span></span></code></pre></div><p>Ниже приведено объяснение того, что делает каждая комбинация сопоставлений:</p><ul><li><p><code>(u/g) 0 100000 1000</code> - сопоставить 1000 идентификаторов, начинающихся с 0, с идентификаторами, начинающимися с 100000. Это означает, что ROOT UID/GID 0:0 на госте будет сопоставлен с 100000:100000 на хосте, 1:1 будет сопоставлен с 100001:1000001 и т. д.</p></li><li><p><code>(u/g) 1000 1000 1</code> - сопоставить пару UID/GID 1000:1000 с 1000:1000 на хосте. Номер 1 нужен для указания того, что мы сопоставляем только один ID, а не диапазон.</p></li><li><p><code>(u/g) 1001 101001 64535</code> - сопоставить 64535 идентификаторов, начинающихся с 1001, с идентификаторами, начинающимися с 101001. Это означает, что пара UID/GID 1001:1001 на гостевой системе будет сопоставлена ​​с 101001:101001, 1002:1002 с 101002:101002 и так далее до 65535:65535 с 165535:165535.</p></li></ul><h3 id="конфигурация-в-гостевои-системе" tabindex="-1"><a class="header-anchor" href="#конфигурация-в-гостевои-системе"><span>Конфигурация в гостевой системе</span></a></h3><p>Если пользователя 1000:1000 нет, то создадим аналогично хосту:</p><div class="language-" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>useradd -M -s /sbin/nologin -u 1000 username</span></span></code></pre></div><p>И установим владельца и права:</p><div class="language-" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>chown username:username /mnt/data -R</span></span>
<span class="line"><span>chmod u=rwx,g=rwx,o=rx,g+s /mnt/data</span></span></code></pre></div><p>При такой настройке пользователь с идентификатором 1000 или любой пользователь, являющийся членом группы, теперь может иметь доступ к <code>/mnt/data</code>.</p>`,37))])}const h=a(p,[["render",d]]),g=JSON.parse('{"path":"/docs/proxmox/using-local-directory-v-unprivileged-container.html","title":"Привязать точку монтирования от хоста к непривилегированному контейнеру LXC","lang":"ru-RU","frontmatter":{"title":"Привязать точку монтирования от хоста к непривилегированному контейнеру LXC","shortTitle":"Bind Mount Points","icon":"folder-plus","date":"2025-03-11T00:00:00.000Z","category":["Proxmox"],"tag":["LXC","mount"],"star":true,"description":"Чтобы пробросить HDD(SSD) в LXC контейнер, на самом деле папку на хосте, нужно выполнить команду:","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Привязать точку монтирования от хоста к непривилегированному контейнеру LXC\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2025-03-11T00:00:00.000Z\\",\\"dateModified\\":\\"2025-06-05T19:52:28.000Z\\",\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://klimov.su/docs/proxmox/using-local-directory-v-unprivileged-container.html"}],["meta",{"property":"og:site_name","content":"Дмитрий Климов"}],["meta",{"property":"og:title","content":"Привязать точку монтирования от хоста к непривилегированному контейнеру LXC"}],["meta",{"property":"og:description","content":"Чтобы пробросить HDD(SSD) в LXC контейнер, на самом деле папку на хосте, нужно выполнить команду:"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"ru-RU"}],["meta",{"property":"og:updated_time","content":"2025-06-05T19:52:28.000Z"}],["meta",{"property":"article:tag","content":"mount"}],["meta",{"property":"article:tag","content":"LXC"}],["meta",{"property":"article:published_time","content":"2025-03-11T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-06-05T19:52:28.000Z"}]]},"git":{"createdTime":1749153148000,"updatedTime":1749153148000,"contributors":[{"name":"Godparent","username":"Godparent","email":"dmitriy@klimov.su","commits":1,"url":"https://github.com/Godparent"}]},"readingTime":{"minutes":1.95,"words":584},"filePathRelative":"docs/proxmox/using-local-directory-v-unprivileged-container.md","excerpt":"<p>Чтобы пробросить HDD(SSD) в LXC контейнер, на самом деле папку на хосте, нужно выполнить команду:</p>\\n","autoDesc":true}');export{h as comp,g as data};
